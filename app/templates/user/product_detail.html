{% extends "base.html" %}
{% block title %}{{ product.ten_san_pham }}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-10">

  <!-- HÌNH ẢNH -->
  <div>
    {% set main_image = product.hinh_anhs
    | selectattr("anh_chinh", "equalto", 1)
    | first %}

    <img src="{{ url_for('static', filename=main_image.duong_dan) }}" class="w-full rounded-lg object-cover" />

    {% set extra_images = product.hinh_anhs
    | selectattr("anh_chinh", "equalto", 0)
    | list %}

    {% if extra_images %}
    <div class="grid grid-cols-4 gap-3 mt-4">
      {% for img in extra_images %}
      <img src="{{ url_for('static', filename=img.duong_dan) }}" class="h-24 w-full object-cover rounded-lg border" />
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <!-- THÔNG TIN CHÍNH -->
  <div>
    <h1 class="text-3xl font-bold mb-3">
      {{ product.ten_san_pham }}
    </h1>

    <!-- TRẠNG THÁI -->
    {% if product.so_luong > 0 %}
    <span class="inline-block mb-4 rounded-full bg-green-100 px-4 py-1 text-green-700 text-sm">
      Còn hàng
    </span>
    {% else %}
    <span class="inline-block mb-4 rounded-full bg-red-100 px-4 py-1 text-red-700 text-sm">
      Hết hàng
    </span>
    {% endif %}

    <!-- GIÁ -->
    <p class="text-2xl text-red-600 font-bold mb-4">
      {{ product.gia_xuat }} đ
    </p>

    <!-- NÚT -->
    <div class="flex gap-4 mb-6">
      <form action="{{ url_for('cart.add_to_cart', product_id=product.ma_san_pham) }}" method="POST">
        <button type="submit" class="btn-primary" {% if product.so_luong==0 %}disabled{% endif %}>
          Thêm vào giỏ
        </button>
      </form>

      <a href="{{ url_for('cart.buy_now', product_id=product.ma_san_pham) }}" class="btn-secondary inline-flex items-center justify-center px-6 py-3 rounded-lg
                {% if product.so_luong == 0 %}pointer-events-none opacity-50{% endif %}">
        Mua ngay
      </a>
    </div>

    <!-- MÔ TẢ -->
    <div class="border-t pt-4">
      <h2 class="text-lg font-semibold mb-2">
        Mô tả sản phẩm
      </h2>
      <p class="text-gray-600 leading-relaxed">
        {{ product.mo_ta }}
      </p>
    </div>
  </div>

</div>

<!-- THÔNG SỐ KỸ THUẬT -->
<div class="mt-12 border-t pt-6">
  <h2 class="text-2xl font-semibold mb-4">
    Thông tin kỹ thuật
  </h2>

  <table class="w-full border text-sm">
    <tr class="border-b">
      <td class="p-3 font-medium w-1/3">Trọng lượng</td>
      <td class="p-3">{{ product.trong_luong }} g</td>
    </tr>

    <tr class="border-b">
      <td class="p-3 font-medium">Kích thước</td>
      <td class="p-3">{{ product.ma_kich_thuoc }}</td>
    </tr>

    <tr class="border-b">
      <td class="p-3 font-medium">Đơn vị tính</td>
      <td class="p-3">{{ product.don_vi_tinh }}</td>
    </tr>

    <tr class="border-b">
      <td class="p-3 font-medium">Giới tính</td>
      <td class="p-3">
        {% if product.gioi_tinh == 0 %}
        Nam
        {% else %}
        Nữ
        {% endif %}
      </td>
    </tr>
  </table>
</div>

<!-- SẢN PHẨM LIÊN QUAN -->
{% if related_products %}
<div class="mt-12">
  <h2 class="text-2xl font-bold mb-6">
    Sản phẩm liên quan
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    {% for p in related_products %}
    <div class="bg-white rounded-lg shadow hover:shadow-xl overflow-hidden flex flex-col">
      {% set img = p.hinh_anhs | selectattr("anh_chinh", "equalto", 1) | first %}

      <img src="{{ url_for('static', filename=img.duong_dan) }}" class="w-full h-40 object-cover" />

      <div class="p-4 flex flex-col flex-1">
        <h3 class="font-semibold text-sm mb-2">
          {{ p.ten_san_pham }}
        </h3>

        <p class="text-red-600 font-bold mt-auto">
          {{ p.gia_xuat }} đ
        </p>

        <a href="/product/{{ p.ma_san_pham }}" class="text-blue-600 text-sm mt-2">
          Xem chi tiết
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% endblock %}