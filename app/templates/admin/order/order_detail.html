<!-- người chỉnh sửa: Nguyễn Thái Nguyên
thời gian chỉnh sửa: 17/01/2025
nội dung: chỉnh sửa điều hướng và các chức năng liên quan đến trang -->

<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi Tiết Đơn Hàng | Jewelry Store Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-slate-50 text-slate-800">
    <div class="flex min-h-screen">
      <!-- Aside dashboard -->
      {% include "layout_admin/aside_dashboard.html" %}

      <!-- Content -->
      <div class="flex flex-1 flex-col">
        <!-- Header -->
        <header
          class="flex flex-wrap items-center justify-between gap-4 border-b border-slate-200 bg-white px-6 py-4"
        >
          <div>
            <a href="{{ url_for('order.show_order_page') }}">
              <h1
                class="text-xl font-semibold text-slate-900 hover:text-rose-500 transition"
              >
                CHI TIẾT ĐƠN HÀNG #{{ order.ma_don_hang }}
              </h1>
            </a>
            <p class="text-sm text-slate-500">
              Thông tin chi tiết đơn hàng
            </p>
          </div>
          <div class="flex gap-2">
            {% if order.trang_thai == 0 %}
            <form
              method="post"
              action="{{ url_for('order.confirm_order_route', id=order.ma_don_hang) }}"
              class="inline"
            >
              <button
                type="submit"
                class="rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-600"
              >
                Xác nhận đơn hàng
              </button>
            </form>
            {% endif %}
            {% if order.trang_thai not in [3, 4] %}
            <a
              href="{{ url_for('order.show_edit_order_page', id=order.ma_don_hang) }}"
              class="rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:bg-slate-50"
            >
              Chỉnh sửa
            </a>
            {% endif %}
            <a
              href="{{ url_for('order.show_order_page') }}"
              class="rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:bg-slate-50"
            >
              Quay lại
            </a>
          </div>
        </header>

        <!-- Main -->
        <main class="flex-1 px-6 py-8">
          <div class="mx-auto max-w-5xl space-y-6">
            <!-- Thông tin đơn hàng -->
            <div class="rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-100">
              <h2 class="mb-4 text-lg font-semibold text-slate-900">
                Thông tin đơn hàng
              </h2>
              <div class="grid gap-4 md:grid-cols-2">
                <div>
                  <p class="text-sm text-slate-500">Mã đơn hàng</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    #{{ order.ma_don_hang }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Trạng thái</p>
                  <p class="mt-1">
                    {% if order.trang_thai == 0 %}
                    <span class="rounded-full bg-yellow-50 px-3 py-1 text-xs font-medium text-yellow-600">
                      Chờ xác nhận
                    </span>
                    {% elif order.trang_thai == 1 %}
                    <span class="rounded-full bg-blue-50 px-3 py-1 text-xs font-medium text-blue-600">
                      Đang xử lý
                    </span>
                    {% elif order.trang_thai == 2 %}
                    <span class="rounded-full bg-purple-50 px-3 py-1 text-xs font-medium text-purple-600">
                      Đang giao
                    </span>
                    {% elif order.trang_thai == 3 %}
                    <span class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-600">
                      Đã giao
                    </span>
                    {% elif order.trang_thai == 4 %}
                    <span class="rounded-full bg-rose-50 px-3 py-1 text-xs font-medium text-rose-600">
                      Đã hủy
                    </span>
                    {% endif %}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Ngày tạo</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ order.ngay_tao.strftime('%d/%m/%Y %H:%M') if order.ngay_tao else '-' }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Ngày đặt hàng</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ order.ngay_dat_hang.strftime('%d/%m/%Y %H:%M') if order.ngay_dat_hang else '-' }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Tổng tiền tạm tính</p>
                  <p class="mt-1 text-lg font-semibold text-rose-600">
                    {{ "{:,.0f}".format(order.tong_tien_tam_tinh) if order.tong_tien_tam_tinh else "0" }} VNĐ
                  </p>
                </div>
              </div>
            </div>

            <!-- Thông tin khách hàng -->
            <div class="rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-100">
              <h2 class="mb-4 text-lg font-semibold text-slate-900">
                Thông tin khách hàng
              </h2>
              <div class="grid gap-4 md:grid-cols-2">
                <div>
                  <p class="text-sm text-slate-500">Họ tên</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ account.ho_ten if account else 'N/A' }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Email</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ account.email if account else 'N/A' }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Số điện thoại</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ account.so_dien_thoai if account else 'N/A' }}
                  </p>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Địa chỉ</p>
                  <p class="mt-1 text-base font-medium text-slate-900">
                    {{ account.dia_chi if account else 'N/A' }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Chi tiết sản phẩm -->
            <div class="rounded-2xl bg-white p-6 shadow-sm ring-1 ring-slate-100">
              <h2 class="mb-4 text-lg font-semibold text-slate-900">
                Chi tiết sản phẩm
              </h2>
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead class="text-left text-xs uppercase text-slate-400">
                    <tr>
                      <th class="pb-3 font-medium">Mã SP</th>
                      <th class="pb-3 font-medium">Tên sản phẩm</th>
                      <th class="pb-3 font-medium">Số lượng</th>
                      <th class="pb-3 font-medium">Đơn giá</th>
                      <th class="pb-3 font-medium">Thành tiền</th>
                    </tr>
                  </thead>
                  <tbody class="text-slate-600">
                    {% if order_details_with_product %}
                      {% for item in order_details_with_product %}
                      <tr class="border-b">
                        <td class="py-3">{{ item.detail.ma_san_pham }}</td>
                        <td class="py-3 font-medium text-slate-900">
                          {{ item.product.ten_san_pham if item.product else 'Sản phẩm không tồn tại' }}
                        </td>
                        <td class="py-3">{{ item.detail.so_luong }}</td>
                        <td class="py-3">
                          {{ "{:,.0f}".format(item.detail.don_gia) if item.detail.don_gia else "0" }} VNĐ
                        </td>
                        <td class="py-3 font-semibold text-slate-900">
                          {{ "{:,.0f}".format(item.detail.thanh_tien) if item.detail.thanh_tien else "0" }} VNĐ
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr>
                        <td colspan="5" class="py-6 text-center text-slate-400">
                          Không có sản phẩm nào trong đơn hàng này.
                        </td>
                      </tr>
                    {% endif %}
                  </tbody>
                  <tfoot>
                    <tr class="border-t-2 border-slate-200">
                      <td colspan="4" class="py-3 text-right font-semibold text-slate-900">
                        Tổng cộng:
                      </td>
                      <td class="py-3 text-lg font-bold text-rose-600">
                        {{ "{:,.0f}".format(order.tong_tien_tam_tinh) if order.tong_tien_tam_tinh else "0" }} VNĐ
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>
</html>
