{% extends "base.html" %}
{% block title %}Gi·ªè h√†ng{% endblock %}
{% block content %}

<div class="container mx-auto px-6 py-10">

  {# ================= GI·ªé H√ÄNG TR·ªêNG ================= #}
  {% if not cart_items %}
  <div class="flex flex-col items-center justify-center py-24">
    <img src="{{ url_for('static', filename='images/empty-cart.png') }}" class="w-40 mb-6" alt="">

    <h2 class="text-2xl font-semibold mb-2">Gi·ªè h√†ng tr·ªëng üõí</h2>
    <p class="text-gray-500 mb-6">
      Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè
    </p>

    <a href="{{ url_for('main.show_home_page') }}"
      class="px-6 py-3 bg-black text-white rounded hover:bg-gray-800 transition">
      Ti·∫øp t·ª•c mua h√†ng
    </a>
  </div>
  {% endif %}


  {# ================= GI·ªé H√ÄNG C√ì S·∫¢N PH·∫®M ================= #}
  {% if cart_items %}
  <div class="grid grid-cols-12 gap-8">

    <!-- DANH S√ÅCH S·∫¢N PH·∫®M -->
    <div class="col-span-12 lg:col-span-8">
      <h1 class="text-2xl font-bold mb-6">
        Gi·ªè h√†ng ({{ pagination.total_items }} s·∫£n ph·∫©m)
      </h1>

      {% for item in cart_items %}
      <div class="flex items-center border-b py-6">
        <img src="{{ item.image }}" class="w-24 h-24 object-cover rounded">

        <div class="ml-6 flex-1">
          <h3 class="font-semibold">{{ item.name }}</h3>
          <p class="text-gray-500 mt-1">
            {{ "{:,.0f}".format(item.price) }}ƒë
          </p>

          <!-- S·ªê L∆Ø·ª¢NG -->
          <div class="flex items-center mt-4 gap-3">
            <a href="{{ url_for('cart.update_cart', id=item.id, action='decrease') }}"
              onclick="return handleDecrease({{ item.quantity }})"
              class="px-3 py-1 border rounded hover:bg-gray-100">-</a>

            <span class="min-w-[32px] text-center">
              {{ item.quantity }}
            </span>

            <a href="{{ url_for('cart.update_cart', id=item.id, action='increase') }}"
              class="px-3 py-1 border rounded hover:bg-gray-100">+</a>
          </div>
        </div>

        <!-- GI√Å + XO√Å -->
        <div class="text-right">
          <p class="font-semibold">
            {{ "{:,.0f}".format(item.price * item.quantity) }}ƒë
          </p>

          <a href="{{ url_for('cart.remove_cart', id=item.id) }}" onclick="return confirmDeleteItem()"
            class="text-sm text-red-500 hover:underline">
            Xo√°
          </a>
        </div>
      </div>
      {% endfor %}

      <!-- XO√Å H·∫æT -->
      <div class="mt-6">
        <a href="{{ url_for('cart.clear_cart') }}" onclick="return confirmClearCart()"
          class="text-red-600 hover:underline">
          ‚ùå Xo√° h·∫øt gi·ªè h√†ng
        </a>
      </div>

      <!-- PH√ÇN TRANG -->
      {% if pagination.total_pages > 1 %}
      <div class="flex justify-center mt-8 gap-2">
        {% for p in range(1, pagination.total_pages + 1) %}
        <a href="{{ url_for('cart.show_cart_page', page=p) }}" class="px-4 py-2 border rounded
                   {% if p == pagination.page %}bg-black text-white{% endif %}">
          {{ p }}
        </a>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- T·ªîNG ƒê∆†N -->
    <div class="col-span-12 lg:col-span-4 border p-6 rounded-lg h-fit">
      <h2 class="font-bold text-lg mb-4">ƒê∆°n h√†ng</h2>

      <div class="flex justify-between mb-2">
        <span>T·∫°m t√≠nh</span>
        <span>{{ "{:,.0f}".format(total_price) }}ƒë</span>
      </div>

      <div class="flex justify-between font-semibold text-lg border-t pt-4">
        <span>T·ªïng thanh to√°n</span>
        <span>{{ "{:,.0f}".format(total_price) }}ƒë</span>
      </div>

      <form action="{{ url_for('cart.show_checkout_page') }}">
        <button type="submit" class="w-full mt-6 py-3 bg-black text-white rounded hover:bg-gray-800">
          Thanh to√°n
        </button>
      </form>


      <a href="{{ url_for('product.show_all_products') }}" class="block text-center mt-4 text-sm underline">
        Ti·∫øp t·ª•c mua h√†ng
      </a>
    </div>

  </div>
  {% endif %}

</div>

<script>
  function handleDecrease(quantity) {
    // N·∫øu c√≤n 1 m√† b·∫•m gi·∫£m ‚Üí h·ªèi xo√°
    if (quantity <= 1) {
      return confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·∫£n ph·∫©m n√†y kh√¥ng?");
    }
    // N·∫øu > 1 ‚Üí cho gi·∫£m b√¨nh th∆∞·ªùng
    return true;
  }

  function confirmDeleteItem() {
    return confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·∫£n ph·∫©m n√†y kh√¥ng?");
  }

  function confirmClearCart() {
    return confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° t·∫•t c·∫£ s·∫£n ph·∫©m kh√¥ng?");
  }
</script>

{% endblock %}